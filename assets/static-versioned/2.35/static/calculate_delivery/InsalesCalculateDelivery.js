/*!
 * InsalesCalculateDelivery v0.8.12
 * https://github.com/insales/insales-autocomplete-address/
 */
var InsalesCalculateDelivery=function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t,i){var n,s;
/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */!function(r){if(void 0===(s="function"==typeof(n=r)?n.call(t,i,t,e):n)||(e.exports=s),!0,e.exports=r(),!!0){var o=window.Cookies,a=window.Cookies=r();a.noConflict=function(){return window.Cookies=o,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function i(n){function s(){}function r(t,i,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},s.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var o=JSON.stringify(i);/^[\{\[]/.test(o)&&(i=o)}catch(e){}i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var l in r)r[l]&&(a+="; "+l,!0!==r[l]&&(a+="="+r[l].split(";")[0]));return document.cookie=t+"="+i+a}}function o(e,i){if("undefined"!=typeof document){for(var s={},r=document.cookie?document.cookie.split("; "):[],o=0;o<r.length;o++){var a=r[o].split("="),l=a.slice(1).join("=");i||'"'!==l.charAt(0)||(l=l.slice(1,-1));try{var u=t(a[0]);if(l=(n.read||n)(l,u)||t(l),i)try{l=JSON.parse(l)}catch(e){}if(s[u]=l,e===u)break}catch(e){}}return e?s[e]:s}}return s.set=r,s.get=function(e){return o(e,!1)},s.getJSON=function(e){return o(e,!0)},s.remove=function(t,i){r(t,"",e(i,{expires:-1}))},s.defaults={},s.withConverter=i,s}((function(){}))}))},function(e,t){e.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,n,s,r,o,a,l="",u=0;for(e=this._utf8_encode(e);u<e.length;)s=(t=e.charCodeAt(u++))>>2,r=(3&t)<<4|(i=e.charCodeAt(u++))>>4,o=(15&i)<<2|(n=e.charCodeAt(u++))>>6,a=63&n,isNaN(i)?o=a=64:isNaN(n)&&(a=64),l=l+this._keyStr.charAt(s)+this._keyStr.charAt(r)+this._keyStr.charAt(o)+this._keyStr.charAt(a);return l},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}}},function(e,t,i){const n=i(13).default;i(5),e.exports=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(6),s=i(7),r=i(9),o=()=>{},a=new s.TimeoutError;t.default=class extends n{constructor(e){var t,i,n,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=o,this._resolveIdle=o,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:r.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(i=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==i?i:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(s=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==s?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=o,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=o,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((i,n)=>{this._queue.enqueue(async()=>{this._pendingCount++,this._intervalCount++;try{const r=void 0===this._timeout&&void 0===t.timeout?e():s.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&n(a)});i(await r)}catch(e){n(e)}this._next()},t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},function(e,t,i){const n=i(12).default;i(11),e.exports=n()},function(e,t,i){"use strict";i.r(t)},function(e,t,i){"use strict";var n=Object.prototype.hasOwnProperty,s="~";function r(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,i,n,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new o(i,n||e,r),l=s?s+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function u(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),u.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},u.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o},u.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},u.prototype.emit=function(e,t,i,n,r,o){var a=s?s+e:e;if(!this._events[a])return!1;var l,u,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,n),!0;case 5:return c.fn.call(c.context,t,i,n,r),!0;case 6:return c.fn.call(c.context,t,i,n,r,o),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,i);break;case 4:c[u].fn.call(c[u].context,t,i,n);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},u.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},u.prototype.removeListener=function(e,t,i,n){var r=s?s+e:e;if(!this._events[r])return this;if(!t)return l(this,r),this;var o=this._events[r];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||l(this,r);else{for(var a=0,u=[],c=o.length;a<c;a++)(o[a].fn!==t||n&&!o[a].once||i&&o[a].context!==i)&&u.push(o[a]);u.length?this._events[r]=1===u.length?u[0]:u:l(this,r)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&l(this,t)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=s,u.EventEmitter=u,e.exports=u},function(e,t,i){"use strict";const n=i(8);class s extends Error{constructor(e){super(e),this.name="TimeoutError"}}const r=(e,t,i)=>new Promise((r,o)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void r(e);const a=setTimeout(()=>{if("function"==typeof i){try{r(i())}catch(e){o(e)}return}const n=i instanceof Error?i:new s("string"==typeof i?i:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),o(n)},t);n(e.then(r,o),()=>{clearTimeout(a)})});e.exports=r,e.exports.default=r,e.exports.TimeoutError=s},function(e,t,i){"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(10);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const i={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(i);const s=n.default(this._queue,i,(e,t)=>t.priority-e.priority);this._queue.splice(s,0,i)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i){let n=0,s=e.length;for(;s>0;){const r=s/2|0;let o=n+r;i(e[o],t)<=0?(n=++o,s-=r+1):s=r}return n}},function(e,t,i){"use strict";i.r(t)},function(e,t,i){"use strict";i.r(t);var n=i(2),s=i.n(n),r=e=>{let t=o();var i=e,n=/(\d)(?=(\d\d\d)+(?!\d))/g;if(null==e)return"";if(i="."!=t.delimiter?i.toString().replace(",",".").replace(t.delimiter,""):i.toString().replace(",","."),i=(i=parseFloat(i).toFixed(2)||0).toString().split("."),t.show_price_without_cents){for(var s=0;s<i.length;s++)"."!=t.delimiter&&(i[s]=i[s].replace(t.delimiter,""));var r=i.join(".");i=(a=Math.round(r)).toString().replace(n,"$1"+t.delimiter)}else{i[0]=i[0].replace(n,"$1"+t.delimiter);var a=i.join(t.separator);i=a}return i=t.format.replace("%n",i).replace("%u",t.unit)};let o=()=>{let e={delimiter:"",separator:".",format:"%n&nbsp;%u",unit:"руб",show_price_without_cents:0};try{let t=document.querySelector('[name="shop-config"]').dataset.config;t&&(e=JSON.parse(t).money_with_currency_format,e.unit=JSON.parse(t).default_currency.unit)}catch(e){console.warn(e)}return e};let a=(e,t)=>{let i=document.createElement("div");return i.classList.add(e),i.innerHTML=t,i},l=(e,t)=>{let i="",n=u(e.price),s=u(e.price_min),o=u(e.price_max),a=u(e.charge_up_to);return e.price&&0==n||e.price_max&&0==o?t.free:(i=void 0!==e.price_min&&void 0!==e.price_max&&s!==o?`${r(s)}&nbsp;-&nbsp;${r(o)}`:void 0!==e.price_min&&o&&s==o?r(s):void 0!==e.price_min?`${t.from}&nbsp;${r(s)}`:void 0!==e.price_max?`${t.to}&nbsp;${r(o)}`:0==n||a&&n>a?t.free:r(n),i)},u=e=>{var t,i="string"==typeof e;if(!("number"==typeof e)&&!i)return 0;if(i){var n=(e=(e=e.replace(/\s/g,"")).replace(/,/g,".")).split(".");e=(e=void 0!==n[1]?n[0].replace(/\D/g,"")+"."+n[1].replace(/\D/g,""):n[0].replace(/\D/g,"")).replace(/px/g,""),e=isNaN(+e)?1:+e}return Number((t=e,Number(t)===t&&t%1!=0?e.toFixed(2):e))};var c=i(0),d=i.n(c),h=i(1),p=i.n(h),f={ru:{delivery_to:"Доставка в",free:"бесплатно",from:"от",details:"подробнее",loading:"Рассчитываем доставку...",to:"до",days:"дней",change_city:"Выберите город",empty:"<ul><li>Нет подходящих способов доставки 😢</li></ul>"},ua:{delivery_to:"Доставка в",free:"безкоштовно",from:"от",details:"детальніше",loading:"Розраховуємо доставку ...",to:"до",days:"днів",change_city:"Виберіть місто",empty:"<ul><li>Немає відповідних способів доставки 😢</li></ul>"},en:{delivery_to:"Delivery to",free:"free",from:"from",details:"details",loading:"loading...",to:"to",days:"days",change_city:"Select city",empty:"<ul><li>There are no suitable shipping methods 😢</li></ul>"},es:{delivery_to:"Entregar a",free:"está libre",from:"de",details:"más detalles",loading:"Calculamos la entrega...",to:"antes de",days:"dias",change_city:"Ciudad selecta",empty:"<ul><li>No hay métodos de envío adecuados 😢</li></ul>"}},v=i(3),y=i.n(v);class _{constructor(e,{variantId:t=null,productId:i=null,bind_cart:n=!0,consider_quantity:r=!0,current_default_locality_mode:o="shop_settings",countries:a=[{code:"RU",title:"Россия"}],default_address:l={country:"RU",state:"г Москва",city:"Москва"},messages:u=f,quantity:c=1},h,v){if(this.options={messages:f[h.locale]||f.ru,bind_cart:n,consider_quantity:r,default_address:l,countries:a,current_default_locality_mode:o},this.debug=!1,this.state=v,this.data={variants:{},address_data:{}},this.processed=!1,this.success=!1,this.deliveries=null,this.observer=null,this.variantId=t,this.productId=i,this.siteConfig=h||{},this.quantity=c,this.quantityCart=0,this.initialized=!1,this.$deliveryBlock=e,this.$modal=this.$deliveryBlock.querySelector(".insales_widget-modal"),this.addressData={},this.current_country=d.a.get("current_country")||this.options.default_address.country||this.options.countries[0].code,this.selectorInfoBlock=".insales_widget-delivery_info",this.InstanceInsalesAutocompleteAdress=new s.a(".insales-autocomplete-address",{debounceTime:0,country:this.current_country,onChange:e=>{e&&(this.addressData=e,(e=>{let t=p.a.encode(JSON.stringify(e));d.a.set("address_location",encodeURIComponent(t),{expires:7})})(e),this.renderDeliveries("new InsalesAutocompleteAdress"),this.initialized=!0,this.initModal())}}),this.setText(),this.bindVariant(),window.addEventListener("orientationchange",e=>{this.checkSize()}),"undefined"!=typeof IntersectionObserver){let e=(e,t)=>{e.forEach(e=>{this.checkSize()})};this.observer=new IntersectionObserver(e,{}),this.observer.observe(this.$deliveryBlock)}else this.checkSize()}checkSize(){let e=this.$deliveryBlock.offsetWidth;0!==e&&e<480&&(this.$deliveryBlock.classList.remove("insales_widget-delivery_info-is_wide"),this.$deliveryBlock.classList.add("insales_widget-delivery_info-is_narrow"),this.observer&&this.observer.disconnect()),0!==e&&e>=480&&(this.$deliveryBlock.classList.remove("insales_widget-delivery_info-is_narrow"),this.$deliveryBlock.classList.add("insales_widget-delivery_info-is_wide"),this.observer&&this.observer.disconnect())}initModal(){let e=this.$deliveryBlock.querySelector(".insales_widget-open_modal"),t=this.$deliveryBlock.querySelector(".insales_widget-modal_close"),i=this.$deliveryBlock.querySelector(".insales_widget-modal_overlay");i||(i=document.createElement("div"),i.classList.add("insales_widget-modal_overlay"),this.$deliveryBlock.appendChild(i)),e&&e.addEventListener("click",e=>{e.preventDefault(),this.openModal()}),i&&i.addEventListener("click",e=>{e.preventDefault(),this.closeModal()}),t&&t.addEventListener("click",e=>{e.preventDefault(),this.closeModal()}),document.addEventListener("keydown",e=>{27==e.which&&this.closeModal()})}openModal(){this.$modal.classList.add("insales_widget-modal_open");let e=this.$deliveryBlock.querySelector(".insales_widget-modal_overlay");e&&(e.style.display="block");let t=this.$deliveryBlock.querySelector("#insales_widget-full_locality_name");t&&window.matchMedia("(max-width: 640px)").matches&&t.focus()}closeModal(){this.$modal.classList.remove("insales_widget-modal_open");let e=this.$deliveryBlock.querySelector(".insales_widget-modal_overlay");e&&(e.style.display="none")}bindVariant(){if("undefined"!=typeof EventBus)EventBus.subscribe("update_variant:insales:product",e=>{if(e.action){e.action.quantityState.change||e.action.quantityState.less||e.product_id!=this.productId||this.setVariantId(e.id)}}),EventBus.subscribe("change_quantity:insales:product",e=>{this.options.consider_quantity&&e.product_id==this.productId&&this.setQuantity(e.action.quantity.current)}),EventBus.subscribe("change_quantity:insales:vue_product",e=>{this.options.consider_quantity&&e.product_id==this.productId&&(this.setVariantId(e.currentVariantId),this.setQuantity(Math.ceil(e.currentCount)))}),EventBus.subscribe(["add_items:insales:cart","set_items:insales:cart","remove_items:insales:cart"],e=>{this.options.bind_cart&&this.renderDeliveries("setQuantityCart")});else{let e=this.$deliveryBlock.closest("form"),t=e.querySelector('[name="variant_id"]'),i=e.querySelector('[name="quantity"]');t&&t.addEventListener("change",e=>{this.setVariantId(e.target.value)}),i&&i.addEventListener("change",e=>{this.options.consider_quantity&&this.setQuantity(e.target.value)})}}setQuantityCart(e,t){e!=this.quantityCart&&(this.quantityCart=e,t||this.renderDeliveries("setQuantityCart"))}setQuantity(e){e!=this.quantity&&(this.quantity=e,this.renderDeliveries("setQuantity"))}setVariantId(e){if(this.variantId==e&&this.processed)return!1;this.variantId=e,this.renderDeliveries("setVariantId")}getVariants(){return{[this.variantId]:this.quantity+this.quantityCart}}setText(){let e=this.$deliveryBlock.querySelector('[for="insales_widget-full_locality_name"]'),t=this.$deliveryBlock.querySelector(".insales_widget-label");e&&(e.innerText=this.options.messages.delivery_to),t&&(t.innerText=this.options.messages.delivery_to)}renderEditable(){let e=this.$deliveryBlock.querySelector(".insales_widget-editable");e&&(e.innerHTML=`<div class="insales_widget-current_address"><span>${this.addressData.result}</span><button class="insales_widget-open_modal">Изменить</button></div>`)}isMultiCountry(){return this.options.countries.length}renderModal(){let e=this.$deliveryBlock.querySelector(".insales_widget-modal-header-top");if(e){let t=e.querySelector(".insales_widget-modal-country");if(!e.querySelector(".insales_widget-modal-label")){let t=document.createElement("div");t.classList.add("insales_widget-modal-label"),this.isMultiCountry()&&t.classList.add("insales_widget-modal-with_country"),t.innerText="Выберите город",e.appendChild(t)}this.isMultiCountry()&&!t&&e.appendChild(this.getSelectCountry())}this.initModal()}getSelectCountry(){let e=null;if(this.isMultiCountry()){let t=document.createElement("select");t.value=this.current_country,t.setAttribute("value",this.current_country),t.classList.add("insales_widget-modal-country"),t.addEventListener("change",e=>{var t;this.current_country!=e.target.value&&(this.current_country=e.target.value,this.InstanceInsalesAutocompleteAdress.setCountry(this.current_country),t=this.current_country,d.a.set("current_country",t,{expires:7}))}),this.options.countries.forEach(e=>{let i=new Option(e.title,e.code,"",this.current_country==e.code);e.code==this.current_country&&i.setAttribute("selected","selected");try{t.add(i)}catch(e){t.appendChild(i)}}),e=t}return e}renderDeliveries(e){let t=this;this.state.queue.add(()=>new Promise((i,n)=>{t.processed=!0;var s={variants:this.getVariants(),address_data:this.addressData};let r=t.state.getData()||{},o={variants:r.variants,address_data:r.address_data};if(t.renderEditable(),t.renderModal(),this.$deliveryBlock.querySelectorAll(this.selectorInfoBlock).forEach(e=>{e&&(e.innerHTML=`<div class="insales_widget-delivery_loading">${this.options.messages.loading}</div>`)}),"setQuantityCart"!==e&&JSON.stringify(s)===JSON.stringify(o)&&s.address_data||void 0===s.address_data.result)return t.renderResponse(r.res),void i();t.state.setData(s),fetch("/front_api/deliveries/calculate.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(e=>new Promise((function(t,i){try{e.json().then(e=>{t(e)},t=>{console.log(e),i(t)})}catch(e){i(e)}}))).then(e=>{t.state.setData({res:e}),t.processed=!1,t.success=!0,t.renderResponse(e),i()}).catch(()=>{i()})}),{priority:t.state.indexElement})}renderResponse(e){let t=this;if(!e)return;let i=this.$deliveryBlock.querySelectorAll(this.selectorInfoBlock),n=document.createElement("ul");t.deliveries=e.deliveries,e.deliveries.forEach(e=>{(e.title||e.description)&&n.appendChild(((e,t)=>{let i=document.createElement("li"),n=a("insales_widget-delivery_info--content",""),s=a("insales_widget-delivery_info--description",e.description),r="string"==typeof e.description&&e.description.trim(),o=r&&e.description&&e.description!=e.title?"<i>i</i>":"",u=a("insales_widget-delivery_info--title",`${e.title}&nbsp;${o}`);r&&e.description&&e.description!=e.title&&r&&(u.classList.add("with-description"),u.setAttribute("title",t.details));let c=l(e,t),d=a("insales_widget-delivery_info--price","");e.show_price&&(d.innerHTML=c);let h=e.delivery_interval,p="";h.min_days==h.max_days&&h.max_days?p+=` ${t.to}&nbsp;${h.max_days}`:(h.min_days&&(p+=` ${t.from}&nbsp;${h.min_days}`),h.max_days&&h.max_days>h.min_days&&(p+=` ${t.to}&nbsp;${h.max_days}`)),(h.min_days||h.max_days)&&(p+=" "+t.days),i.setAttribute("data-insales-widget-delivery-id",e.id),i.classList.add("insales_widget-delivery_info--item"),t.free==c&&i.classList.add("insales_widget-delivery_info--free-item");let f=a("insales_widget-delivery_info--interval",p);return n.insertAdjacentElement("beforeend",u),r&&n.insertAdjacentElement("beforeend",s),i.insertAdjacentElement("beforeend",n),i.insertAdjacentElement("beforeend",d),i.insertAdjacentElement("beforeend",f),i})(e,this.options.messages))}),i.length&&(0==e.deliveries.length?i.forEach(e=>{e.innerHTML=t.options.messages.empty}):i.forEach(e=>{e.innerHTML=n.outerHTML}));let s=document.getElementsByClassName("insales_widget-delivery_info--title with-description");for(let e of s)e.addEventListener("click",(function(e){let t=this.nextElementSibling;if(t){t.classList.contains("is-open")?t.classList.remove("is-open"):t.classList.add("is-open")}}))}}let m=function(){let e={},t=new y.a({concurrency:1,throwOnTimeout:!0});function i(){return e}function n(t){for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}let s=document.querySelectorAll(".insales_widget-delivery"),r=document.querySelector('[name="shop-config"]');s.forEach((e,s)=>{try{let o=e.dataset.options,a=JSON.parse(r.dataset.config);e.InstanceInsalesCalculateDelivery||(e.InstanceInsalesCalculateDelivery=new _(e,JSON.parse(o),a,{getData:i,setData:n,queue:t,indexElement:s}))}catch(e){console.warn(e)}})};t.default=function(){"undefined"!=typeof EventBus&&document.querySelector("#app")&&document.querySelector(".palette_1")?EventBus.subscribe("mounted:insales:vue",m):document.addEventListener("DOMContentLoaded",m)}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.r(t);var o,a=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.webkitMatchesSelector?e.webkitMatchesSelector(t):null},l=function(e,t){return e.closest?e.closest(t):function(e,t){for(var i=e;i&&1===i.nodeType;){if(a(i,t))return i;i=i.parentNode}return null}(e,t)},u=function(e){return Boolean(e&&"function"==typeof e.then)},c=function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=i.search,o=i.autoSelect,a=void 0!==o&&o,c=i.setValue,d=void 0===c?function(){}:c,h=i.setAttribute,p=void 0===h?function(){}:h,f=i.onUpdate,v=void 0===f?function(){}:f,y=i.onSubmit,_=void 0===y?function(){}:y,m=i.onShow,g=void 0===m?function(){}:m,b=i.onHide,w=void 0===b?function(){}:b,C=i.onLoading,S=void 0===C?function(){}:C,x=i.onLoaded,I=void 0===x?function(){}:x;n(this,e),r(this,"value",""),r(this,"searchCounter",0),r(this,"results",[]),r(this,"selectedIndex",-1),r(this,"handleInput",(function(e){var i=e.target.value;t.updateResults(i),t.value=i})),r(this,"handleKeyDown",(function(e){var i=e.key;switch(i){case"Up":case"Down":case"ArrowUp":case"ArrowDown":var n="ArrowUp"===i||"Up"===i?t.selectedIndex-1:t.selectedIndex+1;e.preventDefault(),t.handleArrows(n);break;case"Tab":t.selectResult();break;case"Enter":var s=t.results[t.selectedIndex];t.selectResult(),t.onSubmit(s);break;case"Esc":case"Escape":t.hideResults(),t.setValue();break;default:return}})),r(this,"handleFocus",(function(e){var i=e.target.value;t.updateResults(i),t.value=i})),r(this,"handleBlur",(function(){t.hideResults()})),r(this,"handleResultMouseDown",(function(e){e.preventDefault()})),r(this,"handleResultClick",(function(e){var i=e.target,n=l(i,"[data-result-index]");if(n){t.selectedIndex=parseInt(n.dataset.resultIndex,10);var s=t.results[t.selectedIndex];t.selectResult(),t.onSubmit(s)}})),r(this,"handleArrows",(function(e){var i=t.results.length;t.selectedIndex=(e%i+i)%i,t.onUpdate(t.results,t.selectedIndex)})),r(this,"selectResult",(function(){var e=t.results[t.selectedIndex];e&&t.setValue(e),t.hideResults()})),r(this,"updateResults",(function(e){var i=++t.searchCounter;t.onLoading(),t.search(e).then((function(e){i===t.searchCounter&&(t.results=e,t.onLoaded(),0!==t.results.length?(t.selectedIndex=t.autoSelect?0:-1,t.onUpdate(t.results,t.selectedIndex),t.showResults()):t.hideResults())}))})),r(this,"showResults",(function(){t.setAttribute("aria-expanded",!0),t.onShow()})),r(this,"hideResults",(function(){t.selectedIndex=-1,t.results=[],t.setAttribute("aria-expanded",!1),t.setAttribute("aria-activedescendant",""),t.onUpdate(t.results,t.selectedIndex),t.onHide()})),r(this,"checkSelectedResultVisible",(function(e){var i=e.querySelector('[data-result-index="'.concat(t.selectedIndex,'"]'));if(i){var n=e.getBoundingClientRect(),s=i.getBoundingClientRect();s.top<n.top?e.scrollTop-=n.top-s.top:s.bottom>n.bottom&&(e.scrollTop+=s.bottom-n.bottom)}})),this.search=u(s)?s:function(e){return Promise.resolve(s(e))},this.autoSelect=a,this.setValue=d,this.setAttribute=p,this.onUpdate=v,this.onSubmit=_,this.onShow=g,this.onHide=w,this.onLoading=S,this.onLoaded=I},d=0,h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(e).concat(++d)},p=function(e,t){var i=e.getBoundingClientRect(),n=t.getBoundingClientRect();return i.bottom+n.height>window.innerHeight&&window.innerHeight-i.bottom<i.top&&window.pageYOffset+i.top-n.height>0?"above":"below"},f=function(e,t,i){var n;return function(){var s=this,r=arguments,o=function(){n=null,i||e.apply(s,r)},a=i&&!n;clearTimeout(n),n=setTimeout(o,t),a&&e.apply(s,r)}},v=function(){function e(t,i,s){n(this,e),this.id="".concat(s,"-result-").concat(t),this.class="".concat(s,"-result"),this["data-result-index"]=t,this.role="option",t===i&&(this["aria-selected"]="true")}var t,i,r;return t=e,(i=[{key:"toString",value:function(){var e=this;return Object.keys(this).reduce((function(t,i){return"".concat(t," ").concat(i,'="').concat(e[i],'"')}),"")}}])&&s(t.prototype,i),r&&s(t,r),e}(),y=function e(t){var i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=s.search,a=s.onSubmit,l=void 0===a?function(){}:a,u=s.onUpdate,d=void 0===u?function(){}:u,y=s.baseClass,_=void 0===y?"autocomplete":y,m=s.autoSelect,g=s.getResultValue,b=void 0===g?function(e){return e}:g,w=s.renderResult,C=s.debounceTime,S=void 0===C?0:C;n(this,e),r(this,"expanded",!1),r(this,"loading",!1),r(this,"position",{}),r(this,"resetPosition",!0),r(this,"initialize",(function(){i.root.style.position="relative",i.input.setAttribute("role","combobox"),i.input.setAttribute("autocomplete","off"),i.input.setAttribute("autocapitalize","off"),i.input.setAttribute("autocorrect","off"),i.input.setAttribute("spellcheck","false"),i.input.setAttribute("aria-autocomplete","list"),i.input.setAttribute("aria-haspopup","listbox"),i.input.setAttribute("aria-expanded","false"),i.resultList.setAttribute("role","listbox"),i.resultList.style.position="absolute",i.resultList.style.zIndex="1",i.resultList.style.width="100%",i.resultList.style.boxSizing="border-box",i.resultList.id||(i.resultList.id=h("".concat(i.baseClass,"-result-list-"))),i.input.setAttribute("aria-owns",i.resultList.id),document.body.addEventListener("click",i.handleDocumentClick),i.input.addEventListener("input",i.core.handleInput),i.input.addEventListener("keydown",i.core.handleKeyDown),i.input.addEventListener("focus",i.core.handleFocus),i.input.addEventListener("blur",i.core.handleBlur),i.resultList.addEventListener("mousedown",i.core.handleResultMouseDown),i.resultList.addEventListener("click",i.core.handleResultClick),i.updateStyle()})),r(this,"setAttribute",(function(e,t){i.input.setAttribute(e,t)})),r(this,"setValue",(function(e){i.input.value=e?i.getResultValue(e):""})),r(this,"renderResult",(function(e,t){return"<li ".concat(t,">").concat(i.getResultValue(e),"</li>")})),r(this,"handleUpdate",(function(e,t){i.resultList.innerHTML="",e.forEach((function(e,n){var s=new v(n,t,i.baseClass),r=i.renderResult(e,s);"string"==typeof r?i.resultList.insertAdjacentHTML("beforeend",r):i.resultList.insertAdjacentElement("beforeend",r)})),i.input.setAttribute("aria-activedescendant",t>-1?"".concat(i.baseClass,"-result-").concat(t):""),i.resetPosition&&(i.resetPosition=!1,i.position=p(i.input,i.resultList),i.updateStyle()),i.core.checkSelectedResultVisible(i.resultList),i.onUpdate(e,t)})),r(this,"handleShow",(function(){i.expanded=!0,i.updateStyle()})),r(this,"handleHide",(function(){i.expanded=!1,i.resetPosition=!0,i.updateStyle()})),r(this,"handleLoading",(function(){i.loading=!0,i.updateStyle()})),r(this,"handleLoaded",(function(){i.loading=!1,i.updateStyle()})),r(this,"handleDocumentClick",(function(e){i.root.contains(e.target)||i.core.hideResults()})),r(this,"updateStyle",(function(){i.root.dataset.expanded=i.expanded,i.root.dataset.loading=i.loading,i.root.dataset.position=i.position,i.resultList.style.visibility=i.expanded?"visible":"hidden",i.resultList.style.pointerEvents=i.expanded?"auto":"none","below"===i.position?(i.resultList.style.bottom=null,i.resultList.style.top="100%"):(i.resultList.style.top=null,i.resultList.style.bottom="100%")})),this.root="string"==typeof t?document.querySelector(t):t,this.input=this.root.querySelector("input"),this.resultList=this.root.querySelector("ul"),this.baseClass=_,this.getResultValue=b,this.onUpdate=d,"function"==typeof w&&(this.renderResult=w);var x=new c({search:o,autoSelect:m,setValue:this.setValue,setAttribute:this.setAttribute,onUpdate:this.handleUpdate,onSubmit:l,onShow:this.handleShow,onHide:this.handleHide,onLoading:this.handleLoading,onLoaded:this.handleLoaded});S>0&&(x.handleInput=f(x.handleInput,S)),this.core=x,this.initialize()},_=(o=0,e=>new Promise(t=>{let i=document.createElement("script"),n="_jsonp_"+o++;e.match(/\?/)?e+="&callback="+n:e+="?callback="+n,i.src=e,window[n]=e=>{t(new Response(JSON.stringify(e))),i.remove(),delete window[n]},document.body.appendChild(i)})),m=(e,t)=>{const i=`https://kladr.insales.ru/fulltext_search.json?q=${e}&country=${t}&with_parent=1`;return new Promise((t,n)=>{if(e.length<2)return t([]);_(i,{mode:"no-cors",method:"GET"}).then(e=>e.json()).then(e=>{e.error?n(e.error):t(e)}).catch(e=>{console.warn(e),n(e)})})};let g=(e,t)=>{var i=new CustomEvent(e,{detail:{data:t}});document.dispatchEvent(i)},b=()=>new Promise((e,t)=>{_("https://kladr.insales.ru/locate.json",{mode:"no-cors",method:"GET"}).then(e=>e.json()).then(t=>{e(t)}).catch(e=>{console.warn(e),t(e)})});var w=(e,t)=>new Promise((i,n)=>{if(!localStorage&&t||localStorage&&!localStorage[e]&&t)b().then(e=>{i(e)}).catch(e=>{i(null)});else try{let t=JSON.parse(localStorage[e]);i(t)}catch(e){i(null)}}),C=(e,t,i)=>(g("update:lacation:insales:autocomplete:address",t),new Promise((i,n)=>{if(localStorage)try{localStorage[e]=JSON.stringify(t),i()}catch(e){n(e)}else i()}));t.default=class{constructor(e,{onChange:t=(()=>{}),autoLocation:i=!0,country:n="RU",debounceTime:s=0}){this.options={onChange:t,debounceTime:s,autoLocation:i,country:n},this.items=document.querySelectorAll(e),this.storageKey="InsalesAutocompleteAddress",this.currentLocation="",this.searchQuery="",this.AutocompleteInstance=null,this.items.length?(w(this.storageKey,this.options.autoLocation).then(e=>{this.items.forEach(t=>{this.createAutocomplete(t),e&&C(this.storageKey,e)})}),document.addEventListener("update:lacation:insales:autocomplete:address",e=>{this.setValue(e.detail.data),this.options.onChange(e.detail.data),this.currentLocation=e.detail.data.result})):console.warn("Передан неверный селектор: "+e)}setValue(e){this.items.forEach(t=>{let i=t.querySelector(".insales-autocomplete-address-input");e.result&&i&&i.value!==e.result&&(i.value=e.result)})}setCountry(e){this.options.country=e,m(this.searchQuery,this.options.country)}createAutocomplete(e){let t=this.options,i=e.querySelector(".insales-autocomplete-address-input");i&&(i.onkeydown=function(e){if(13===e.which)return e.preventDefault(),e.stopPropagation(),!1}),e.classList.add("insales-autocomplete-address"),this.AutocompleteInstance=new y(e,{search:e=>(this.searchQuery=e,new Promise((i,n)=>{m(e,t.country).then(t=>{0==t.length&&e.length>5?i([{isError:!0,result:"Город не найден"}]):i(t)}).catch(t=>{""!=e&&i([{isError:!0,result:"Город не найден"}])})})),baseClass:"insales-autocomplete-address",autoSelect:!0,debounceTime:t.debounceTime,getResultValue:e=>e.isError?this.currentLocation:e.result,renderResult:(e,t)=>`\n          <li ${t}>\n            <div class="insales-autocomplete-address-title">\n              ${((e,t)=>{let i=new RegExp(`(${t})`,"gi");return e.replace(i,"<strong>$1</strong>")})(e.result,this.searchQuery)}\n            </div>\n          </li>\n        `,onSubmit:e=>{e&&!e.isError&&C(this.storageKey,e,i)}})}}}]);
//# sourceMappingURL=InsalesCalculateDelivery.js.map
